(()=>{"use strict";const t=function(){function t(t){var e={color:t.boundsColor,thickness:t.boundsThickness,padding:t.boundaryPadding,rect:{left:0+t.boundaryPadding,right:t.width-t.boundaryPadding,top:0+t.boundaryPadding,bottom:t.height-t.boundaryPadding}},o=document.querySelector(t.selector),n=o.getContext("2d");o.width=t.width,o.height=t.height,this.body=o,this.context=n,this.bounds=e,this.width=t.width,this.height=t.height,this.background=t.background}return t.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},t.prototype.drawBackground=function(){this.context.fillStyle=this.background,this.context.fillRect(0,0,this.width,this.height)},t.prototype.drawBoundary=function(){var t=this.bounds;this.context.strokeStyle=this.bounds.color,this.context.lineWidth=this.bounds.thickness,this.context.strokeRect(t.rect.left,t.rect.top,t.rect.right-t.padding,t.rect.bottom-t.padding)},t}();var e=function(){return e=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},e.apply(this,arguments)},o=function(){function t(t){Object.assign(this,t);var e=this.parent.screen.context;e.font="".concat(t.fontSize,"px ").concat(t.fontName);var o={topLeft:{x:0,y:0},bottomLeft:{x:0,y:0},topRight:{x:0,y:0},bottomRight:{x:0,y:0}},n="".concat(this.label,":"),r=e.measureText(n),i=e.measureText("".concat(0)),c=r.width+i.width,s=r.actualBoundingBoxAscent+r.actualBoundingBoxDescent;o.topLeft={x:this.x,y:this.y},o.bottomLeft={x:this.x,y:this.y+s+this.lineSpacing},o.topRight={x:this.x+c,y:this.y},o.bottomRight={x:this.x+c,y:this.y+s+this.lineSpacing},this.rect=o}return t.prototype.updateValue=function(t){this.value=t},t.prototype.render=function(){var t=this.parent.screen.context;t.font="".concat(this.fontSize,"px ").concat(this.fontName),t.fillStyle=this.labelColor,t.fillText("".concat(this.label,": "),this.x,this.y),t.fillStyle=this.valueColor,t.fillText("".concat(this.value),this.x+t.measureText("".concat(this.label)).width+13,this.y)},t}();const n=function(){function t(t){Object.assign(this,t),this.items=[]}return t.prototype.createElement=function(t){var n=t.id,r=t.label,i=t.x,c=t.y,s=new o(e({id:n,label:r,x:i,y:c},{value:"empty",parent:this,fontSize:16,fontName:"monospace",lineSpacing:4,labelColor:"white",valueColor:"white"}));return this.items.push(s),s},t.prototype.getElementById=function(t){return this.items.find((function(e){return e.id===t}))},t.prototype.render=function(){for(var t=0,e=this.items;t<e.length;t++)e[t].render()},t}(),r=function(t){Object.assign(this,t)};var i,c=(i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},i(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});const s=function(t){function e(e){return t.call(this,e)||this}return c(e,t),e}(r);var a=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),h=function(){return h=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},h.apply(this,arguments)};const l=function(t){function e(e){var o;return e=h(h({},e),{type:"ball",dx:0,dy:0,angle:90,isLinkedToPlatform:!0,isWaitingStart:!0,bounces:{lastBounceFrom:0,fromBrick:0,fromPlatform:0,fromBoundary:0}}),o=t.call(this,e)||this,Object.assign(o,e),o}return a(e,t),e.prototype.calculateAngleChange=function(t){var e=Math.sqrt(this.dx*this.dx+this.dy*this.dy),o=Math.atan2(this.dy,this.dx);o+=t,this.dx=Math.cos(o)*e,this.dy=Math.sin(o)*e},e.prototype.calculateBounceWith=function(t){var e=t.x+t.width/2,o=(this.x-e)/(t.width/2)*(Math.PI/3),n=Math.sqrt(Math.pow(this.dx,2)+Math.pow(this.dy,2));this.dx=n*Math.sin(o),this.dy=-n*Math.cos(o)},e.prototype.calculateNextPosition=function(){var t=this.dx,e=this.dy;0===t&&0===e||(this.x+=t,this.y+=e)},e}(r);var u=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();const d=function(t){function e(e){var o=t.call(this,e)||this;return Object.assign(o,e),o}return u(e,t),e}(r);var f=function(t,e,o){if(o||2===arguments.length)for(var n,r=0,i=e.length;r<i;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))};const p=function(){function t(t){Object.assign(this,t);var e={platform:new s({width:100,height:8,x:t.screen.width/2-50,y:t.screen.height-69,color:"rgb(115, 115, 115)",type:"platform"}),ball:new l({type:"ball",color:"white",x:t.screen.width/2,y:t.screen.height-75,width:6,height:6}),bricks:this.generateBricksGrid(t.bricksGridPos.startX,t.bricksGridPos.startY,t.bricksGridPos.endX,t.bricksGridPos.endY),all:[]};e.all=f([e.platform,e.ball],e.bricks,!0),this.objects=e,this.score=0}return t.prototype.generateBricksGrid=function(t,e,o,n,r){void 0===r&&(r=20);for(var i=Math.floor((o-t)/(r+1)),c=Math.floor((n-e)/(r+1)),s=[],a=0;a<i;a++)for(var h=0;h<c;h++)s.push(new d({width:r,height:r,x:t+a*(r+1),y:e+h*(r+1),color:"blue",type:"brick",health:1}));return s},t.prototype.processIntersections=function(){for(var t=this.objects,e=t.ball,o=t.platform,n=t.bricks,r=this.screen.bounds,i=(f(f([o,e],n,!0),[this.screen.bounds],!1),e.y-e.width),c=e.y+e.width,s=e.x-e.width,a=e.x+e.width,h=o.y,l=(o.y,o.height,o.x),u=o.x+o.width,d=.4*Math.random()-.2,p=0,y=n;p<y.length;p++){var b=y[p];if(b.health>0){var g=Math.max(b.x,Math.min(e.x,b.x+b.width)),x=Math.max(b.y,Math.min(e.y,b.y+b.height)),w=e.x-g,m=e.y-x;w*w+m*m<=e.width*e.width&&(b.color="rgba(255, 255, 255, 0.05)",b.health=0,e.dx*=-1,"bound"!==e.bounces.lastBounceFrom&&(e.dy*=-1),e.bounces.fromBrick+=1,e.bounces.lastBounceFrom=b.type,this.onBrickBreak(e.bounces))}}e.isLinkedToPlatform||c>=h&&s<=u&&a>=l&&(e.y=h-e.width,e.calculateBounceWith(o),e.calculateAngleChange(d),e.bounces.fromPlatform+=1,e.bounces.lastBounceFrom=o.type),i<=r.rect.top&&(e.y=r.rect.top+e.width),c>=r.rect.bottom&&(e.y=r.rect.bottom-e.width),s<r.rect.left&&(e.x=r.rect.left+e.width),a>=r.rect.right&&(e.x=r.rect.right-e.width),(i<=r.rect.top||c>=r.rect.bottom)&&(e.dy*=-1),(s<r.rect.left||a>=r.rect.right)&&(e.dx*=-1),(i<=r.rect.top||c>=r.rect.bottom||s<r.rect.left||a>=r.rect.right)&&(e.bounces.fromBoundary+=1,e.bounces.lastBounceFrom="bound")},t.prototype.run=function(){this.objects.ball.calculateNextPosition()},t.prototype.render=function(){for(var t=this.screen.context,e=0,o=this.objects.all;e<o.length;e++){var n=o[e];if(n instanceof d||n instanceof s){var r=n.x,i=n.y,c=n.width,a=n.height,h=n.color;t.fillStyle=h,t.fillRect(r,i,c,a)}else if(n instanceof l){var u=n,f=(r=u.x,i=u.y,c=u.width,h=u.color,u.isLinkedToPlatform);t.beginPath(),t.arc(r,i,c,0,2*Math.PI,!1),t.fillStyle=!0===f?"green":h,t.fill(),t.closePath()}}},t}();document.addEventListener("DOMContentLoaded",(function(){var e=new t({width:800,height:500,background:"black",selector:'div[data-game-id="brick-breaker"] canvas',boundaryPadding:10,boundsColor:"red",boundsThickness:2,hideMouse:!0}),o=new n({screen:e,fontSize:16});o.createElement({id:"scores",label:"Scroes",x:20,y:30});var r=new p({screen:e,bricksGridPos:{startX:0+8*e.bounds.padding,startY:0+8*e.bounds.padding,endX:e.width-8*e.bounds.padding,endY:300+2*e.bounds.padding},onBrickBreak:function(t){o.getElementById("scores").updateValue(10*t.fromBrick)}});document.body.addEventListener("mousemove",(function(t){if(t.layerX>=0&&t.layerX<=e.width){var o=r.objects,n=o.platform,i=o.ball,c=t.layerX-n.width/2;c>=e.bounds.rect.left&&c<=e.bounds.rect.right-n.width&&(n.x=c,!0===i.isLinkedToPlatform&&(i.x=c+n.width/2))}})),e.body.addEventListener("click",(function(){if(!0===r.objects.ball.isWaitingStart){var t=r.objects.ball;t.isWaitingStart=!1,t.isLinkedToPlatform=!1,t.dx=4*Math.cos(t.angle),t.dy=-4*Math.sin(t.angle)}}));var i=function(){e.drawBackground(),e.drawBoundary(),r.run(),r.processIntersections(),r.render(),o.render(),requestAnimationFrame(i)};requestAnimationFrame(i),console.log(r)}))})();