(()=>{"use strict";const t=function(){function t(t){var e={color:t.boundsColor,thickness:t.boundsThickness,padding:t.boundaryPadding,rect:{left:0+t.boundaryPadding,right:t.width-t.boundaryPadding,top:0+t.boundaryPadding,bottom:t.height-t.boundaryPadding}},o=document.querySelector(t.selector),n=o.getContext("2d");o.width=t.width,o.height=t.height,this.body=o,this.context=n,this.bounds=e,this.width=t.width,this.height=t.height,this.background=t.background}return t.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},t.prototype.drawBackground=function(){this.context.fillStyle=this.background,this.context.fillRect(0,0,this.width,this.height)},t.prototype.drawBoundary=function(){var t=this.bounds;this.context.strokeStyle=this.bounds.color,this.context.lineWidth=this.bounds.thickness,this.context.strokeRect(t.rect.left,t.rect.top,t.rect.right-t.padding,t.rect.bottom-t.padding)},t}();var e=function(){return e=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},e.apply(this,arguments)},o=function(){function t(t){Object.assign(this,t);var e=this.parent.screen.context;e.font="".concat(t.fontSize,"px ").concat(t.fontName);var o={topLeft:{x:0,y:0},bottomLeft:{x:0,y:0},topRight:{x:0,y:0},bottomRight:{x:0,y:0}},n="".concat(this.label,":"),r=e.measureText(n),i=e.measureText("".concat(0)),c=r.width+i.width,a=r.actualBoundingBoxAscent+r.actualBoundingBoxDescent;o.topLeft={x:this.x,y:this.y},o.bottomLeft={x:this.x,y:this.y+a+this.lineSpacing},o.topRight={x:this.x+c,y:this.y},o.bottomRight={x:this.x+c,y:this.y+a+this.lineSpacing},this.rect=o}return t.prototype.updateValue=function(t){this.value=t},t.prototype.render=function(){var t=this.parent.screen.context;t.font="".concat(this.fontSize,"px ").concat(this.fontName),t.fillStyle=this.labelColor,t.fillText("".concat(this.label,": "),this.x,this.y),t.fillStyle=this.valueColor,t.fillText("".concat(this.value),this.x+t.measureText("".concat(this.label)).width+13,this.y)},t}();const n=function(){function t(t){Object.assign(this,t),this.items=[]}return t.prototype.createElement=function(t){var n=t.id,r=t.label,i=t.x,c=t.y,a=new o(e({id:n,label:r,x:i,y:c},{value:"empty",parent:this,fontSize:16,fontName:"monospace",lineSpacing:4,labelColor:"white",valueColor:"white"}));return this.items.push(a),a},t.prototype.getElementById=function(t){return this.items.find((function(e){return e.id===t}))},t.prototype.render=function(){for(var t=0,e=this.items;t<e.length;t++)e[t].render()},t}(),r=function(){function t(t){Object.assign(this,t)}return t.prototype.renderAt=function(t){},t}();var i,c=(i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},i(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});const a=function(t){function e(e){return t.call(this,e)||this}return c(e,t),e.prototype.renderAt=function(t){var e=t.context,o=this,n=o.x,r=o.y,i=o.width,c=o.height,a=o.color;e.fillStyle=a,e.fillRect(n,r,i,c)},e}(r);var s=function(){return s=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},s.apply(this,arguments)};const h=function(){function t(t){this.trace=[],t=s(s({},t),{memoryLimit:25,trainType:"solid",color:"rgba(255, 255, 255, 1)"}),Object.assign(this,t)}return t.prototype.getLastPoint=function(){return this.trace.length>0&&(t=this.trace)[t.length-1];var t},t.prototype.getlength=function(){return this.trace.length},t.prototype.add=function(t){"number"==typeof t.x&&"number"==typeof t.y&&(this.trace.length>=this.memoryLimit&&this.trace.shift(),this.trace.push(t))},t.prototype.renderAt=function(t){var e=this,o=t.context;o.lineWidth=1;var n=!1;this.trace.forEach((function(t,r){if("boolean"!=typeof n){var i=r/e.trace.length;o.strokeStyle=(c=e.color,a=i,a=Math.max(0,Math.min(a,1)),c.split(", ").map((function(t,e){return 3==e&&(t=a+")"),t})).join(", ")),o.beginPath(),o.moveTo(n.x,n.y),o.lineTo(t.x,t.y),o.stroke()}var c,a;n=t}))},t}();var l=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),u=function(){return u=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},u.apply(this,arguments)};const d=function(t){function e(e){var o,n={dx:0,dy:0,angle:90,trace:new h({}),isLinkedToPlatform:!0,isWaitingStart:!0,bounces:{lastBounceFrom:0,fromBrick:0,fromPlatform:0,fromBoundary:0}};return e=u(u({},e),n),o=t.call(this,e)||this,Object.assign(o,e),o}return l(e,t),e.prototype.calculateAngleChange=function(t){var e=Math.sqrt(this.dx*this.dx+this.dy*this.dy),o=Math.atan2(this.dy,this.dx);o+=t,this.dx=Math.cos(o)*e,this.dy=Math.sin(o)*e},e.prototype.calculateBounceWith=function(t){var e=t.x+t.width/2,o=(this.x-e)/(t.width/2)*(Math.PI/3),n=Math.sqrt(Math.pow(this.dx,2)+Math.pow(this.dy,2));this.dx=n*Math.sin(o),this.dy=-n*Math.cos(o)},e.prototype.calculateNextPosition=function(){var t=this.dx,e=this.dy;0===t&&0===e||(this.x+=t,this.y+=e,this.trace.add({x:this.x,y:this.y}))},e.prototype.renderAt=function(t){var e=t.context,o=this,n=o.x,r=o.y,i=o.width,c=o.color,a=o.isLinkedToPlatform;e.beginPath(),e.arc(n,r,i,0,2*Math.PI,!1),e.fillStyle=!0===a?"green":c,e.fill(),e.closePath(),this.trace.renderAt(t)},e}(r);var f=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();const p=function(t){function e(e){var o=t.call(this,e)||this;return Object.assign(o,e),o}return f(e,t),e.prototype.updateHealth=function(t){this.health=t,this.color=this.getColorBasedOnHealth(t)},e.prototype.getColorBasedOnHealth=function(t){return["rgba(255, 255, 255, 0.05)","rgba(0, 0, 255, 0.2)","rgba(0, 0, 255, 0.4)","rgba(0, 0, 255, 0.6)","rgba(0, 0, 255, 0.8)","rgba(0, 0, 255, 1)"][t]},e.prototype.renderAt=function(t){var e=t.context,o=this,n=o.x,r=o.y,i=o.width,c=o.height,a=o.color;e.fillStyle=a,e.fillRect(n,r,i,c)},e}(r);var y=function(t,e,o){if(o||2===arguments.length)for(var n,r=0,i=e.length;r<i;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))};const b=function(){function t(t){Object.assign(this,t);var e={platform:new a({width:100,height:8,x:t.screen.width/2-50,y:t.screen.height-69,color:"rgb(115, 115, 115)"}),ball:new d({color:"white",x:t.screen.width/2,y:t.screen.height-75,width:6,height:6}),bricks:this.generateBricksGrid(t.bricksGridPos.startX,t.bricksGridPos.startY,t.bricksGridPos.endX,t.bricksGridPos.endY),all:[]};e.all=y([e.platform,e.ball],e.bricks,!0),this.objects=e,this.score=0}return t.prototype.generateBricksGrid=function(t,e,o,n,r){void 0===r&&(r=20);for(var i=Math.floor((o-t)/(r+1)),c=Math.floor((n-e)/(r+1)),a=[],s=0;s<i;s++)for(var h=0;h<c;h++){var l=Math.floor(1+5*Math.random()),u=new p({width:r,height:r,x:t+s*(r+1),y:e+h*(r+1),health:l,color:"rgba(255, 255, 255, 1)"});u.color=u.getColorBasedOnHealth(l),a.push(u)}return a},t.prototype.processIntersections=function(){for(var t=this.objects,e=t.ball,o=t.platform,n=t.bricks,r=this.screen.bounds,i=(y(y([o,e],n,!0),[this.screen.bounds],!1),e.y-e.width),c=e.y+e.width,a=e.x-e.width,s=e.x+e.width,h=o.y,l=(o.y,o.height,o.x),u=o.x+o.width,d=.4*Math.random()-.2,f=0,p=n;f<p.length;f++){var b=p[f];if(b.health>0){var g=Math.max(b.x,Math.min(e.x,b.x+b.width)),x=Math.max(b.y,Math.min(e.y,b.y+b.height)),m=e.x-g,w=e.y-x;m*m+w*w<=e.width*e.width&&(b.updateHealth(b.health-1),e.dx*=-1,"bound"!==e.bounces.lastBounceFrom&&(e.dy*=-1),e.bounces.fromBrick+=1,e.bounces.lastBounceFrom="brick",this.onBrickBreak(e.bounces))}}e.isLinkedToPlatform||c>=h&&a<=u&&s>=l&&(e.y=h-e.width,e.calculateBounceWith(o),e.calculateAngleChange(d),e.bounces.fromPlatform+=1,e.bounces.lastBounceFrom="platform"),i<=r.rect.top&&(e.y=r.rect.top+e.width),c>=r.rect.bottom&&(e.y=r.rect.bottom-e.width),a<r.rect.left&&(e.x=r.rect.left+e.width),s>=r.rect.right&&(e.x=r.rect.right-e.width),(i<=r.rect.top||c>=r.rect.bottom)&&(e.dy*=-1),(a<r.rect.left||s>=r.rect.right)&&(e.dx*=-1),(i<=r.rect.top||c>=r.rect.bottom||a<r.rect.left||s>=r.rect.right)&&(e.bounces.fromBoundary+=1,e.bounces.lastBounceFrom="bound")},t.prototype.run=function(){this.objects.ball.calculateNextPosition()},t.prototype.render=function(){for(var t=0,e=this.objects.all;t<e.length;t++)e[t].renderAt(this.screen)},t}();document.addEventListener("DOMContentLoaded",(function(){var e=new t({width:800,height:500,background:"black",selector:'div[data-game-id="brick-breaker"] canvas',boundaryPadding:10,boundsColor:"red",boundsThickness:2,hideMouse:!0}),o=new n({screen:e,fontSize:16});o.createElement({id:"scores",label:"Scroes",x:20,y:30});var r=new b({screen:e,bricksGridPos:{startX:0+8*e.bounds.padding,startY:0+8*e.bounds.padding,endX:e.width-8*e.bounds.padding,endY:300+2*e.bounds.padding},onBrickBreak:function(t){o.getElementById("scores").updateValue(10*t.fromBrick)}});document.body.addEventListener("mousemove",(function(t){if(t.layerX>=0&&t.layerX<=e.width){var o=r.objects,n=o.platform,i=o.ball,c=t.layerX-n.width/2;c>=e.bounds.rect.left&&c<=e.bounds.rect.right-n.width&&(n.x=c,!0===i.isLinkedToPlatform&&(i.x=c+n.width/2))}})),e.body.addEventListener("click",(function(){if(!0===r.objects.ball.isWaitingStart){var t=r.objects.ball;t.isWaitingStart=!1,t.isLinkedToPlatform=!1,t.dx=4*Math.cos(t.angle),t.dy=-4*Math.sin(t.angle)}}));var i=function(){e.drawBackground(),e.drawBoundary(),r.run(),r.processIntersections(),r.render(),o.render(),requestAnimationFrame(i)};requestAnimationFrame(i),console.log(r)}))})();