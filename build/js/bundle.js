(()=>{"use strict";const t=function(){function t(t){Object.assign(this,t);var e=document.createElement("canvas");e.width=t.width,e.height=t.height,this.layer=e,this.drawLayer()}return t.prototype.drawLayer=function(){var t=this.layer.getContext("2d");t.fillStyle=this.lineColor;for(var e=0;e<this.height;e+=this.lineSpacing)t.fillRect(0,e,this.width,this.lineHeight)},t}();function e(t,e){return e=Math.max(0,Math.min(e,1)),t.split(", ").map((function(t,o){return 3==o&&(t=e+")"),t})).join(", ")}const o=function(){function o(e){var o={color:e.boundsColor,thickness:e.boundsThickness,padding:e.boundaryPadding,rect:{left:0+e.boundaryPadding,right:e.width-e.boundaryPadding,top:0+e.boundaryPadding,bottom:e.height-e.boundaryPadding}},r=document.querySelector(e.selector),n=r.getContext("2d");r.width=e.width,r.height=e.height,this.body=r,this.context=n,this.bounds=o,this.width=e.width,this.height=e.height,this.background=e.background,this.filter=new t({width:e.width,height:e.height,lineHeight:1,lineSpacing:2,lineColor:"rgba(0, 0, 0, 0.25)"})}return o.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},o.prototype.drawBackground=function(){var t=this.context,e=this.width/2,o=this.height/2,r=this.width/2;t.fillStyle=this.background,t.fillRect(0,0,this.width,this.height);var n=t.createRadialGradient(e,o,.1*r,e,o,r);n.addColorStop(0,"rgba(150, 100, 100, 0.14)"),n.addColorStop(1,"rgba(120, 120, 120, 0)"),t.fillStyle=n,t.beginPath(),t.arc(e,o,r,0,2*Math.PI),t.fill()},o.prototype.renderCrtFilter=function(){this.context.drawImage(this.filter.layer,0,0)},o.prototype.drawBoundary=function(t){var o=this.bounds;if(!0===t){var r=e(this.bounds.color,1);this.context.shadowBlur=130,this.context.shadowColor=r}this.context.strokeStyle=this.bounds.color,this.context.lineWidth=this.bounds.thickness,this.context.strokeRect(o.rect.left,o.rect.top,o.rect.right-o.padding,o.rect.bottom-o.padding)},o}(),r=function(){function t(t){Object.assign(this,t)}return t.prototype.renderAt=function(t){},t}();var n,i=(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});const a=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.renderAt=function(t){var e=t.context,o=this,r=o.x,n=o.y,i=o.width,a=o.height,s=o.color;e.fillStyle=s,e.fillRect(r,n,i,a)},e}(r);var s=function(){return s=Object.assign||function(t){for(var e,o=1,r=arguments.length;o<r;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},s.apply(this,arguments)};const c=function(){function t(t){this.trace=[],t=s(s({},t),{memoryLimit:25,trainType:"solid",color:"rgba(255, 255, 255, 1)"}),Object.assign(this,t)}return t.prototype.getLastPoint=function(){return this.trace.length>0&&(t=this.trace)[t.length-1];var t},t.prototype.getlength=function(){return this.trace.length},t.prototype.add=function(t){"number"==typeof t.x&&"number"==typeof t.y&&(this.trace.length>=this.memoryLimit&&this.trace.shift(),this.trace.push(t))},t.prototype.renderAt=function(t){var o=this,r=t.context;r.lineWidth=1;var n=!1;this.trace.forEach((function(t,i){if("boolean"!=typeof n){var a=i/o.trace.length*.3;r.strokeStyle=e(o.color,a),r.lineWidth=9,r.beginPath(),r.moveTo(n.x,n.y),r.lineTo(t.x,t.y),r.stroke()}n=t}))},t}();var h=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),l=function(){return l=Object.assign||function(t){for(var e,o=1,r=arguments.length;o<r;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},l.apply(this,arguments)};const u=function(t){function e(e){var o,r={dx:0,dy:0,angle:90,trace:new c({}),isLinkedToPlatform:!0,isWaitingStart:!0,bounces:{lastBounceFrom:0,fromBrick:0,fromPlatform:0,fromBoundary:0}};return e=l(l({},e),r),o=t.call(this,e)||this,Object.assign(o,e),o}return h(e,t),e.prototype.calculateAngleChange=function(t){var e=Math.sqrt(this.dx*this.dx+this.dy*this.dy),o=Math.atan2(this.dy,this.dx);o+=t,this.dx=Math.cos(o)*e,this.dy=Math.sin(o)*e},e.prototype.calculateBounceWith=function(t){var e=t.x+t.width/2,o=(this.x-e)/(t.width/2)*(Math.PI/3),r=Math.sqrt(Math.pow(this.dx,2)+Math.pow(this.dy,2));this.dx=r*Math.sin(o),this.dy=-r*Math.cos(o)},e.prototype.calculateNextPosition=function(){var t=this.dx,e=this.dy;0===t&&0===e||(this.x+=t,this.y+=e,this.trace.add({x:this.x,y:this.y}))},e.prototype.renderAt=function(t){var e=t.context,o=this,r=o.x,n=o.y,i=o.width,a=o.color,s=o.isLinkedToPlatform;e.beginPath(),e.arc(r,n,i,0,2*Math.PI,!1),e.fillStyle=!0===s?"green":a,e.fill(),e.closePath(),this.trace.renderAt(t)},e}(r),d=function(){function t(t){Object.assign(this,t)}return t.prototype.load=function(){var t=this,e=new Image;e.src=this.url,e.onload=function(){t.texture=e,t.loaded=!0}},t.prototype.renderAt=function(t){if(!0===this.loaded){var e=t.context;try{e.drawImage(this.texture,this.parent.x,this.parent.y,this.parent.width,this.parent.height)}catch(t){console.error("catched error! "+t)}}},t}();var f=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();const p=function(t){function e(e){var o=t.call(this,e)||this;return Object.assign(o,e),o.texture=new d({url:e.texture,parent:o}),o.texture.load(),o}return f(e,t),e.prototype.updateHealth=function(t){this.health=t,this.color=this.getColorBasedOnHealth(t)},e.prototype.getColorBasedOnHealth=function(t){return["rgba(255, 255, 255, 0.05)","rgba(215, 215, 215, 1)"][t]},e.prototype.renderAt=function(t){if(this.health>0){var e=t.context,o=this,r=o.x,n=o.y,i=o.width,a=o.height,s=o.color;e.fillStyle=s,e.fillRect(r,n,i,a)}},e}(r);var y=function(t,e,o){if(o||2===arguments.length)for(var r,n=0,i=e.length;n<i;n++)!r&&n in e||(r||(r=Array.prototype.slice.call(e,0,n)),r[n]=e[n]);return t.concat(r||Array.prototype.slice.call(e))};const g=function(){function t(t){Object.assign(this,t);var e={platform:new a({width:100,height:8,x:t.screen.width/2-50,y:t.screen.height-69,color:"rgb(255, 0, 0)"}),ball:new u({color:"white",x:t.screen.width/2,y:t.screen.height-75,width:6,height:6}),bricks:this.generateBricksGrid(t.bricksGridPos.startX,t.bricksGridPos.startY,t.bricksGridPos.endX,t.bricksGridPos.endY),all:[]};e.all=y([e.platform,e.ball],e.bricks,!0),this.objects=e,this.score=0}return t.prototype.generateBricksGrid=function(t,e,o,r,n,i){void 0===n&&(n=50),void 0===i&&(i=25);for(var a=Math.floor((o-t)/(n+1)),s=Math.floor((r-e)/(i+1)),c=[],h=0;h<a;h++)for(var l=0;l<s;l++){var u=Math.floor(1+1*Math.random()),d=new p({width:n,height:i,x:t+h*(n+1),y:e+l*(i+1),health:u,color:"rgba(255, 255, 255, 1)",texture:"./b.png"});d.color=d.getColorBasedOnHealth(u),c.push(d)}return c},t.prototype.processIntersections=function(){for(var t=this.objects,e=t.ball,o=t.platform,r=t.bricks,n=this.screen.bounds,i=(y(y([o,e],r,!0),[this.screen.bounds],!1),e.y-e.width),a=e.y+e.width,s=e.x-e.width,c=e.x+e.width,h=o.y,l=(o.y,o.height,o.x),u=o.x+o.width,d=.4*Math.random()-.2,f=0,p=r;f<p.length;f++){var g=p[f];if(g.health>0){var b=Math.max(g.x,Math.min(e.x,g.x+g.width)),x=Math.max(g.y,Math.min(e.y,g.y+g.height)),w=e.x-b,m=e.y-x;w*w+m*m<=e.width*e.width&&(g.updateHealth(g.health-1),e.dx*=-1,"bound"!==e.bounces.lastBounceFrom&&(e.dy*=-1),e.bounces.fromBrick+=1,e.bounces.lastBounceFrom="brick",this.onBrickBreak(e.bounces))}}e.isLinkedToPlatform||a>=h&&s<=u&&c>=l&&(e.y=h-e.width,e.calculateBounceWith(o),e.calculateAngleChange(d),e.bounces.fromPlatform+=1,e.bounces.lastBounceFrom="platform"),i<=n.rect.top&&(e.y=n.rect.top+e.width),a>=n.rect.bottom&&(e.y=n.rect.bottom-e.width),s<n.rect.left&&(e.x=n.rect.left+e.width),c>=n.rect.right&&(e.x=n.rect.right-e.width),(i<=n.rect.top||a>=n.rect.bottom)&&(e.dy*=-1),(s<n.rect.left||c>=n.rect.right)&&(e.dx*=-1),(i<=n.rect.top||a>=n.rect.bottom||s<n.rect.left||c>=n.rect.right)&&(e.bounces.fromBoundary+=1,e.bounces.lastBounceFrom="bound")},t.prototype.run=function(){this.objects.ball.calculateNextPosition()},t.prototype.render=function(){for(var t=this.screen.context,o=0,r=this.objects.all;o<r.length;o++){var n=r[o];if(!0===this.neonStyle){var i=e(n.color,1);t.shadowBlur=30,t.shadowColor=i}else t.shadowBlur=0,t.shadowColor="transparent";n.renderAt(this.screen),t.shadowBlur=0,t.shadowColor="transparent"}},t}();var b=function(){return b=Object.assign||function(t){for(var e,o=1,r=arguments.length;o<r;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},b.apply(this,arguments)},x=function(){function t(t){Object.assign(this,t);var e=this.parent.screen.context;e.font="".concat(t.fontSize,"px ").concat(t.fontName);var o={topLeft:{x:0,y:0},bottomLeft:{x:0,y:0},topRight:{x:0,y:0},bottomRight:{x:0,y:0}},r="".concat(this.label,":"),n=e.measureText(r),i=e.measureText("".concat(0)),a=n.width+i.width,s=n.actualBoundingBoxAscent+n.actualBoundingBoxDescent;o.topLeft={x:this.x,y:this.y},o.bottomLeft={x:this.x,y:this.y+s+this.lineSpacing},o.topRight={x:this.x+a,y:this.y},o.bottomRight={x:this.x+a,y:this.y+s+this.lineSpacing},this.rect=o}return t.prototype.updateValue=function(t){this.value=t},t.prototype.render=function(){var t=this.parent.screen.context;t.font="".concat(this.fontSize,"px ").concat(this.fontName),t.fillStyle=this.labelColor,t.fillText("".concat(this.label,": "),this.x,this.y),t.fillStyle=this.valueColor,t.fillText("".concat(this.value),this.x+t.measureText("".concat(this.label)).width+13,this.y)},t}();const w=function(){function t(t){Object.assign(this,t),this.items=[]}return t.prototype.createElement=function(t){var e=t.id,o=t.label,r=t.x,n=t.y,i=new x(b({id:e,label:o,x:r,y:n},{value:"empty",parent:this,fontSize:16,fontName:"monospace",lineSpacing:4,labelColor:"white",valueColor:"white"}));return this.items.push(i),i},t.prototype.getElementById=function(t){return this.items.find((function(e){return e.id===t}))},t.prototype.render=function(){for(var t=0,e=this.items;t<e.length;t++)e[t].render()},t}(),m=function(){function t(t){this.times=[],this.fps=0,this.x=t.x,this.y=t.y,this.color=t.color,this.updateFPS()}return t.prototype.updateFPS=function(){var t=this;window.requestAnimationFrame((function(){for(var e=performance.now();t.times.length>0&&t.times[0]<=e-1e3;)t.times.shift();t.times.push(e),t.fps=t.times.length,t.updateFPS()}))},t.prototype.getFPS=function(){return this.fps},t.prototype.renderAt=function(t){var e=t.context;e.fillStyle=this.color,e.fillText("FPS:".concat(this.getFPS()),this.x,this.y)},t}();document.addEventListener("DOMContentLoaded",(function(){var t=new o({width:800,height:500,background:"rgba(12, 7, 7, 1)",selector:'div[data-game-id="brick-breaker"] canvas',boundaryPadding:10,boundsColor:"rgba(255, 0, 0, 1)",boundsThickness:2,hideMouse:!0}),e=new w({screen:t,fontSize:16});e.createElement({id:"scores",label:"Scroes",x:20,y:30});var r=new g({screen:t,neonStyle:!0,bricksGridPos:{startX:0+10*t.bounds.padding,startY:0+8*t.bounds.padding,endX:t.width-8*t.bounds.padding,endY:300+2*t.bounds.padding},onBrickBreak:function(t){e.getElementById("scores").updateValue(10*t.fromBrick)}});document.body.addEventListener("mousemove",(function(e){if(e.layerX>=0&&e.layerX<=t.width){var o=r.objects,n=o.platform,i=o.ball,a=e.layerX-n.width/2;a>=t.bounds.rect.left&&a<=t.bounds.rect.right-n.width&&(n.x=a,!0===i.isLinkedToPlatform&&(i.x=a+n.width/2))}})),t.body.addEventListener("click",(function(){if(!0===r.objects.ball.isWaitingStart){var t=r.objects.ball;t.isWaitingStart=!1,t.isLinkedToPlatform=!1,t.dx=4*Math.cos(t.angle),t.dy=-4*Math.sin(t.angle)}}));var n=new m({x:t.body.width-80,y:30,color:"rgba(255, 255, 255, 0.4)"}),i=function(){requestAnimationFrame(i),t.drawBackground(),t.drawBoundary(r.neonStyle),r.run(),r.processIntersections(),r.render(),e.render(),n.renderAt(t),t.renderCrtFilter()};requestAnimationFrame(i),console.log(r)}))})();