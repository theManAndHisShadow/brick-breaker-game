(()=>{"use strict";const t=function(){function t(t){Object.assign(this,t);var e=document.createElement("canvas");e.width=t.width,e.height=t.height,this.layer=e,this.drawLayer()}return t.prototype.drawLayer=function(){var t=this.layer.getContext("2d");t.fillStyle=this.lineColor;for(var e=0;e<this.height;e+=this.lineSpacing)t.fillRect(0,e,this.width,this.lineHeight)},t}();function e(t,e){return e=Math.max(0,Math.min(e,1)),t.split(", ").map((function(t,n){return 3==n&&(t=e+")"),t})).join(", ")}const n=function(){function n(e){var n={color:e.boundsColor,thickness:e.boundsThickness,padding:e.boundaryPadding,rect:{left:0+e.boundaryPadding,right:e.width-e.boundaryPadding,top:0+e.boundaryPadding,bottom:e.height-e.boundaryPadding}},o=document.querySelector(e.selector),r=o.getContext("2d");o.width=e.width,o.height=e.height,this.body=o,this.context=r,this.bounds=n,this.width=e.width,this.height=e.height,this.background=e.background,this.filter=new t({width:e.width,height:e.height,lineHeight:1,lineSpacing:2,lineColor:"rgba(0, 0, 0, 0.25)"})}return n.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},n.prototype.drawBackground=function(){var t=this.context,e=this.width/2,n=this.height/2,o=this.width/2;t.fillStyle=this.background,t.fillRect(0,0,this.width,this.height);var r=t.createRadialGradient(e,n,.1*o,e,n,o);r.addColorStop(0,"rgba(150, 100, 100, 0.14)"),r.addColorStop(1,"rgba(120, 120, 120, 0)"),t.fillStyle=r,t.beginPath(),t.arc(e,n,o,0,2*Math.PI),t.fill()},n.prototype.renderCrtFilter=function(){this.context.drawImage(this.filter.layer,0,0)},n.prototype.drawBoundary=function(t){var n=this.bounds;if(!0===t){var o=e(this.bounds.color,1);this.context.shadowBlur=130,this.context.shadowColor=o}this.context.strokeStyle=this.bounds.color,this.context.lineWidth=this.bounds.thickness,this.context.strokeRect(n.rect.left,n.rect.top,n.rect.right-n.padding,n.rect.bottom-n.padding)},n}(),o=function(){function t(t){Object.assign(this,t)}return t.prototype.renderAt=function(t){},t}();var r,i=(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});const a=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.renderAt=function(t){var e=t.context,n=this,o=n.x,r=n.y,i=n.width,a=n.height,s=n.color;e.fillStyle=s,e.fillRect(o,r,i,a)},e}(o);var s=function(){return s=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},s.apply(this,arguments)};const c=function(){function t(t){this.trace=[],t=s(s({},t),{memoryLimit:25,trainType:"solid",color:"rgba(255, 255, 255, 1)"}),Object.assign(this,t)}return t.prototype.getLastPoint=function(){return this.trace.length>0&&(t=this.trace)[t.length-1];var t},t.prototype.getlength=function(){return this.trace.length},t.prototype.add=function(t){"number"==typeof t.x&&"number"==typeof t.y&&(this.trace.length>=this.memoryLimit&&this.trace.shift(),this.trace.push(t))},t.prototype.renderAt=function(t){var n=this,o=t.context;o.lineWidth=1;var r=!1;this.trace.forEach((function(t,i){if("boolean"!=typeof r){var a=i/n.trace.length*.3;o.strokeStyle=e(n.color,a),o.lineWidth=9,o.beginPath(),o.moveTo(r.x,r.y),o.lineTo(t.x,t.y),o.stroke()}r=t}))},t}();var h=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),l=function(){return l=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},l.apply(this,arguments)};const u=function(t){function e(e){var n,o={dx:0,dy:0,angle:90,trace:new c({}),isLinkedToPlatform:!0,isWaitingStart:!0,bounces:{lastBounceFrom:0,fromBrick:0,fromPlatform:0,fromBoundary:0}};return e=l(l({},e),o),n=t.call(this,e)||this,Object.assign(n,e),n}return h(e,t),e.prototype.calculateAngleChange=function(t){var e=Math.sqrt(this.dx*this.dx+this.dy*this.dy),n=Math.atan2(this.dy,this.dx);n+=t,this.dx=Math.cos(n)*e,this.dy=Math.sin(n)*e},e.prototype.calculateBounceWith=function(t){var e=t.x+t.width/2,n=(this.x-e)/(t.width/2)*(Math.PI/3),o=Math.sqrt(Math.pow(this.dx,2)+Math.pow(this.dy,2));this.dx=o*Math.sin(n),this.dy=-o*Math.cos(n)},e.prototype.calculateNextPosition=function(){var t=this.dx,e=this.dy;0===t&&0===e||(this.x+=t,this.y+=e,this.trace.add({x:this.x,y:this.y}))},e.prototype.renderAt=function(t){var e=t.context,n=this,o=n.x,r=n.y,i=n.width,a=n.color,s=n.isLinkedToPlatform;e.beginPath(),e.arc(o,r,i,0,2*Math.PI,!1),e.fillStyle=!0===s?"green":a,e.fill(),e.closePath(),this.trace.renderAt(t)},e}(o),d=function(){function t(t){Object.assign(this,t),this.load()}return t.prototype.load=function(){var t=this,e=new Image;e.src=this.url,e.onload=function(){t.texture=e,t.loaded=!0}},t.prototype.renderAt=function(t){if(!0===this.loaded){var e=t.context;try{e.drawImage(this.texture,this.parent.x,this.parent.y,this.parent.width,this.parent.height)}catch(t){console.error("catched error! "+t)}}},t}();var f=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const p=function(t){function e(e){var n=t.call(this,e)||this;return Object.assign(n,e),n.texture=new d({url:e.texture,parent:n}),n.texture.load(),n}return f(e,t),e.prototype.updateHealth=function(t){this.health=t,this.color=this.getColorBasedOnHealth(t)},e.prototype.getColorBasedOnHealth=function(t){return["rgba(255, 255, 255, 0.05)","rgba(215, 215, 215, 1)"][t]},e.prototype.renderAt=function(t){if(this.health>0){var e=t.context,n=this,o=n.x,r=n.y,i=n.width,a=n.height,s=n.color;e.fillStyle=s,e.fillRect(o,r,i,a)}},e}(o),y=function(){function t(){this.events={}}return t.prototype.addEventListener=function(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)},t.prototype.dispatchEvent=function(t,e){this.events[t]&&this.events[t].forEach((function(t){return t(e)}))},t}();var b=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),g=function(t,e,n){if(n||2===arguments.length)for(var o,r=0,i=e.length;r<i;r++)!o&&r in e||(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))};const x=function(t){function n(e){var n=t.call(this)||this;Object.assign(n,e);var o={platform:new a({width:100,height:8,x:e.screen.width/2-50,y:e.screen.height-69,color:"rgb(255, 0, 0)"}),ball:new u({color:"white",x:e.screen.width/2,y:e.screen.height-75,width:6,height:6}),bricks:n.generateBricksGrid(e.bricksGridPos.startX,e.bricksGridPos.startY,e.bricksGridPos.endX,e.bricksGridPos.endY),all:[]};return o.all=g([o.platform,o.ball],o.bricks,!0),n.objects=o,n.score=0,n}return b(n,t),n.prototype.generateBricksGrid=function(t,e,n,o,r,i){void 0===r&&(r=50),void 0===i&&(i=25);for(var a=Math.floor((n-t)/(r+1)),s=Math.floor((o-e)/(i+1)),c=[],h=0;h<a;h++)for(var l=0;l<s;l++){var u=Math.floor(1+1*Math.random()),d=new p({width:r,height:i,x:t+h*(r+1),y:e+l*(i+1),health:u,color:"rgba(255, 255, 255, 1)",texture:"./b.png"});d.color=d.getColorBasedOnHealth(u),c.push(d)}return c},n.prototype.processIntersections=function(){for(var t=this.objects,e=t.ball,n=t.platform,o=t.bricks,r=this.screen.bounds,i=(g(g([n,e],o,!0),[this.screen.bounds],!1),e.y-e.width),a=e.y+e.width,s=e.x-e.width,c=e.x+e.width,h=n.y,l=(n.y,n.height,n.x),u=n.x+n.width,d=.4*Math.random()-.2,f=0,p=o;f<p.length;f++){var y=p[f];if(y.health>0){var b=Math.max(y.x,Math.min(e.x,y.x+y.width)),x=Math.max(y.y,Math.min(e.y,y.y+y.height)),v=e.x-b,w=e.y-x;v*v+w*w<=e.width*e.width&&(y.updateHealth(y.health-1),e.dx*=-1,"bound"!==e.bounces.lastBounceFrom&&(e.dy*=-1),e.bounces.fromBrick+=1,e.bounces.lastBounceFrom="brick",this.dispatchEvent("brickBreak",e.bounces))}}e.isLinkedToPlatform||a>=h&&s<=u&&c>=l&&(e.y=h-e.width,e.calculateBounceWith(n),e.calculateAngleChange(d),e.bounces.fromPlatform+=1,e.bounces.lastBounceFrom="platform",this.dispatchEvent("platformBounce",{})),i<=r.rect.top&&(e.y=r.rect.top+e.width),a>=r.rect.bottom&&(e.y=r.rect.bottom-e.width),s<r.rect.left&&(e.x=r.rect.left+e.width),c>=r.rect.right&&(e.x=r.rect.right-e.width),(i<=r.rect.top||a>=r.rect.bottom)&&(e.dy*=-1),(s<r.rect.left||c>=r.rect.right)&&(e.dx*=-1),(i<=r.rect.top||a>=r.rect.bottom||s<r.rect.left||c>=r.rect.right)&&(e.bounces.fromBoundary+=1,e.bounces.lastBounceFrom="bound",this.dispatchEvent("boundBounce",{}))},n.prototype.run=function(){this.objects.ball.calculateNextPosition()},n.prototype.render=function(){for(var t=this.screen.context,n=0,o=this.objects.all;n<o.length;n++){var r=o[n];if(!0===this.neonStyle){var i=e(r.color,1);t.shadowBlur=30,t.shadowColor=i}else t.shadowBlur=0,t.shadowColor="transparent";r.renderAt(this.screen),t.shadowBlur=0,t.shadowColor="transparent"}},n}(y),v=function(){function t(t){Object.assign(this,t),this.texture=new d({url:t.texture,parent:this})}return t.prototype.renderAt=function(t){this.texture.renderAt(t)},t}();var w=function(){return w=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},w.apply(this,arguments)},m=function(){function t(t){Object.assign(this,t);var e=this.parent.screen.context;e.font="".concat(t.fontSize,"px ").concat(t.fontName);var n={topLeft:{x:0,y:0},bottomLeft:{x:0,y:0},topRight:{x:0,y:0},bottomRight:{x:0,y:0}},o="".concat(this.label,":"),r=e.measureText(o),i=e.measureText("".concat(0)),a=r.width+i.width,s=r.actualBoundingBoxAscent+r.actualBoundingBoxDescent;n.topLeft={x:this.x,y:this.y},n.bottomLeft={x:this.x,y:this.y+s+this.lineSpacing},n.topRight={x:this.x+a,y:this.y},n.bottomRight={x:this.x+a,y:this.y+s+this.lineSpacing},this.rect=n}return t.prototype.updateValue=function(t){this.value=t},t.prototype.render=function(){var t=this,e=this.parent.screen.context,n="number"==typeof this.value||"string"==typeof this.value||"boolean"==typeof this.value;e.font="".concat(this.fontSize,"px ").concat(this.fontName),e.fillStyle=this.labelColor,e.fillText("".concat(this.label,": "),this.x,this.y),n?(e.fillStyle=this.valueColor,e.fillText("".concat(this.value),this.x+e.measureText("".concat(this.label)).width+13,this.y)):Array.isArray(this.value)?this.value.forEach((function(e,n){e instanceof v&&e.renderAt(t.parent.screen)})):this.value instanceof v&&this.value.renderAt(this.parent.screen)},t}();const P=function(){function t(t){Object.assign(this,t),this.items=[]}return t.prototype.createElement=function(t){var e={value:0,parent:this,fontSize:16,fontName:"monospace",lineSpacing:4,labelColor:"white",valueColor:"white"},n=new m(w(w({},e),{id:t.id,label:t.label,x:t.x,y:t.y,value:void 0!==t.value?t.value:e.value,valueColor:void 0!==t.valueColor?t.valueColor:e.valueColor}));return this.items.push(n),n},t.prototype.getElementById=function(t){return this.items.find((function(e){return e.id===t}))},t.prototype.render=function(){for(var t=0,e=this.items;t<e.length;t++)e[t].render()},t}(),k=function(){function t(t){this.times=[],this.fps=0,this.x=t.x,this.y=t.y,this.color=t.color,this.updateFPS()}return t.prototype.updateFPS=function(){var t=this;window.requestAnimationFrame((function(){for(var e=performance.now();t.times.length>0&&t.times[0]<=e-1e3;)t.times.shift();t.times.push(e),t.fps=t.times.length-1,t.updateFPS()}))},t.prototype.getFPS=function(){return this.fps},t.prototype.renderAt=function(t){var e=t.context;e.fillStyle=this.color,e.fillText("FPS:".concat(this.getFPS()),this.x,this.y)},t}(),O=function(){function t(t){this.context=new AudioContext,this.rootPath=t.rootPath,this.sfx={},this.music={}}return t.prototype.loadFile=function(t){var e=this,n=t.filename,o=t.type,r=t.name,i=new XMLHttpRequest,a="".concat(this.rootPath).concat(o,"/").concat(n);i.open("GET",a,!0),i.responseType="arraybuffer",i.onload=function(){e.context.decodeAudioData(i.response,(function(t){t?e[o][r]=t:console.log("Error decoding file data using path: "+a)}))},i.onerror=function(){console.log("BufferLoader: XHR error")},i.send()},t.prototype.play=function(t,e,n){var o=this;if(!this[t])throw new Error("Unknown sound type '"+t+"'!");if(this[t]&&!this[t][e])throw new Error("Unknown sound name '"+e+"'!");if(this[t]&&this[t][e]){var r=this.context.createBufferSource();r.buffer=this[t][e];var i=this.context.createGain();i.connect(this.context.destination),i.gain.value=n,r.connect(i),r.start(0),r.onended=function(){r.disconnect(i),i.disconnect(o.context.destination)}}},t}();document.addEventListener("DOMContentLoaded",(function(){var t=new n({width:800,height:500,background:"rgba(12, 7, 7, 1)",selector:'div[data-game-id="brick-breaker"] canvas',boundaryPadding:10,boundsColor:"rgba(255, 0, 0, 1)",boundsThickness:2,hideMouse:!0}),e=new P({screen:t,fontSize:16});e.createElement({id:"current_level",label:"Level",value:1,x:20,y:30}),e.createElement({id:"scores",label:"Scroes",x:20,y:50}),e.createElement({id:"lives",label:"Lives",value:[new v({width:16,height:16,x:80,y:56,texture:"./assets/textures/heart.png"}),new v({width:16,height:16,x:102,y:56,texture:"./assets/textures/heart.png"}),new v({width:16,height:16,x:124,y:56,texture:"./assets/textures/heart.png"})],valueColor:"red",x:20,y:70});var o=new O({rootPath:"./assets/audio/"});o.loadFile({type:"sfx",name:"platform_bounce",filename:"platform_bounce.mp3"}),o.loadFile({type:"sfx",name:"brick_pop",filename:"brick_pop.mp3"}),o.loadFile({type:"sfx",name:"bound_bounce",filename:"bound_bounce.mp3"}),o.loadFile({type:"music",name:"welcome",filename:"welcome.mp3"});var r=new x({screen:t,neonStyle:!0,bricksGridPos:{startX:0+10*t.bounds.padding,startY:0+8*t.bounds.padding,endX:t.width-8*t.bounds.padding,endY:300+2*t.bounds.padding}});r.addEventListener("brickBreak",(function(t){e.getElementById("scores").updateValue(10*t.fromBrick),o.play("sfx","brick_pop",1)})),r.addEventListener("platformBounce",(function(t){o.play("sfx","platform_bounce",1)})),r.addEventListener("boundBounce",(function(t){o.play("sfx","bound_bounce",1)})),document.body.addEventListener("mousemove",(function(e){if(e.layerX>=0&&e.layerX<=t.width){var n=r.objects,o=n.platform,i=n.ball,a=e.layerX-o.width/2;a>=t.bounds.rect.left&&a<=t.bounds.rect.right-o.width&&(o.x=a,!0===i.isLinkedToPlatform&&(i.x=a+o.width/2))}})),t.body.addEventListener("click",(function(){if(!0===r.objects.ball.isWaitingStart){var t=r.objects.ball;t.isWaitingStart=!1,t.isLinkedToPlatform=!1,t.dx=4*Math.cos(t.angle),t.dy=-4*Math.sin(t.angle)}}));var i=new k({x:t.body.width-80,y:30,color:"rgba(255, 255, 255, 0.4)"});setTimeout((function(){o.play("music","welcome",1)}),500);var a=function(){requestAnimationFrame(a),t.drawBackground(),t.drawBoundary(r.neonStyle),r.run(),r.processIntersections(),r.render(),e.render(),i.renderAt(t),t.renderCrtFilter()};requestAnimationFrame(a),console.log(r)}))})();